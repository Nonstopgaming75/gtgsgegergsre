(function(g,oe,b,v,T,C,R,s,$,t,y,U,h,ce,p,se){"use strict";const{TextStyleSheet:le}=y.findByProps("TextStyleSheet"),{View:w,Text:_,Pressable:ue}=h.General,{FormRow:de}=h.Forms;y.findByName("ActionSheet"),y.findByProps("openLazy","hideActionSheet"),y.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton");function ge(e){const n=y.findByProps("colors","meta"),a=y.findByStoreName("ThemeStore");return n.meta.resolveSemanticColor(a.theme,e)}function ye(e){let{title:n,onPress:a,icon:i}=e;const o=t.stylesheet.createThemedStyleSheet({androidRipple:{color:p.semanticColors.ANDROID_RIPPLE},mainText:{fontFamily:t.constants.Fonts.PRIMARY_SEMIBOLD,fontSize:14,includeFontPadding:!1,letterSpacing:void 0,lineHeight:18,textTransform:"none",color:p.semanticColors.HEADER_SECONDARY},icon:{height:14,tintColor:p.semanticColors.HEADER_SECONDARY}}),c=a?ue:w;return t.React.createElement(c,{android_ripple:o.androidRipple,disabled:!1,accessibilityRole:"button",onPress:a,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&t.React.createElement(w,{style:{marginRight:4}},t.React.createElement(de.Icon,{style:o.icon,source:i,size:"small"})),t.React.createElement(_,{style:o.mainText},n))}function N(e){let{title:n,onTitlePress:a,icon:i,children:o,padding:c}=e;const l=t.stylesheet.createThemedStyleSheet({main:{backgroundColor:p.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return t.React.createElement(w,{style:{marginHorizontal:16,marginTop:16}},t.React.createElement(ye,{title:n,onPress:a,icon:i}),t.React.createElement(w,{style:l.main},c?t.React.createElement(w,{style:{paddingHorizontal:16,paddingVertical:16}},o):o))}function he(e){let{addPadding:n}=e;const a=t.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:p.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return t.React.createElement(w,{style:[{marginTop:16,marginBottom:16},n&&{marginHorizontal:16}]},t.React.createElement(w,{style:a.line}))}var z;(function(e){function n(i){let{children:o,onPress:c}=i;return t.React.createElement(fe,{variant:"text-md/bold",onPress:c},o)}e.Bold=n;function a(i){let{children:o,onPress:c}=i;return t.React.createElement(_,{style:{textDecorationLine:"underline"},onPress:c},o)}e.Underline=a})(z||(z={}));function fe(e){let{variant:n,lineClamp:a,color:i,align:o,style:c,onPress:l,getChildren:d,children:u,liveUpdate:D}=e;const[B,je]=t.React.useReducer(function(Ge){return~Ge},0),He=new Date().setMilliseconds(1e3);return D&&setTimeout(function(){return je()},He-Date.now()),t.React.createElement(_,{style:[n?le[n]:{},i?{color:ge(p.semanticColors[i])}:{},o?{textAlign:o}:{},c??{}],numberOfLines:a,onPress:l},d?.()??u)}function V(e){let{onPress:n,icon:a,style:i,destructive:o}=e;const c=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:p.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:p.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:p.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?c.headerStyleIcon:c.cardStyleIcon:i,o&&c.destructiveIcon].filter(function(l){return!!l}),source:a}))}const{View:pe,Text:F}=h.General,{TextStyleSheet:j}=y.findByProps("TextStyleSheet"),H=t.stylesheet.createThemedStyleSheet({count:{...j["text-lg/bold"],color:p.semanticColors.TEXT_NORMAL,textAlign:"center"},subtitle:{...j["text-md/medium"],color:p.semanticColors.TEXT_MUTED,textAlign:"center"}});function G(e){let{subtitle:n,count:a,contents:i}=e;return React.createElement(pe,{style:{alignItems:"center",justifyContent:"center",marginHorizontal:16}},React.createElement(F,{style:H.count},a),React.createElement(F,{style:H.subtitle},n))}const I="https://vd-cloudsync.nexpid.workers.dev/",Y={clientId:"1120793656878714913",redirectURL:`${I}api/oauth2-response`};async function Se(e){const n=await fetch(`${I}api/oauth2-response?code=${encodeURIComponent(e)}&vendetta=true`);if(n.status===200)return await n.text();throw(await n.json())?.message}async function Re(){if(!r.authorization)return;const e=await fetch(`${I}api/get-data`,{headers:{authorization:r.authorization}});if(e.status===200)return await e.json();throw(await e.json())?.message}async function X(e){if(!r.authorization)return;const n=await fetch(`${I}api/sync-data`,{method:"POST",headers:{authorization:r.authorization,"content-type":"application/json"},body:JSON.stringify(e)});if(n.status===200)return await n.json();throw(await n.json())?.message}async function we(){if(!r.authorization)return;const e=await fetch(`${I}api/delete-data`,{method:"DELETE",headers:{authorization:r.authorization}});if(e.status===200)return await e.json();throw(await e.json())?.message}const{pushModal:ve,popModal:me}=y.findByProps("pushModal","popModal"),Ee=y.findByName("OAuth2AuthorizeModal");function be(){ve({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:Ee,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:Y.clientId,redirectUri:Y.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(e){let{location:n}=e;try{const a=new URL(n).searchParams.get("code"),i=await Se(a);r.authorization=i,M(),R.showToast("Successfully authenticated",s.getAssetIDByName("Check"))}catch(a){R.showToast(a?.message??a?.toString()??"An error occured during authentication",s.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return me("oauth2-authorize")}},closable:!0}})}const Te=window.nativeModuleProxy.BundleUpdaterManager;async function K(){const e={themes:[],plugins:[]};for(const n of Object.values(T.plugins)){const a=r.pluginSettings[n.id];if(a?.syncPlugin===!1)continue;const i=a?.syncStorage===!1?{}:await b.createMMKVBackend(n.id).get();e.plugins.push({id:n.id,enabled:n.enabled,options:i})}for(const n of Object.values(C.themes))e.themes.push({id:n.id,enabled:n.selected});return e}async function Ce(e){if(!S.save)return;let n=!1;const a=S.save.sync.plugins.filter(function(u){return!Object.keys(T.plugins).includes(u.id)&&!u.id.includes("cloud-sync")}),i=a.filter(function(u){return!O(u.id)});let o=!0;i[0]&&await P(!0,"Unproxied Plugins",`Do you want to install **${i.length}** unproxied plugin${i.length!==1?"s":""}? Unproxied plugins haven't been verified by Vendetta staff and thus possibly dangerous. Are you sure you want to continue?`,"Proceed","Skip",void 0,async function(){o=!1});const c=a.filter(function(u){return o?!0:O(u.id)});c.length>0&&await P(e,"Install Plugins",`Would you like to install **${c.length}** new plugin${c.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const u of a)b.createMMKVBackend(u.id).set(u.options),await T.installPlugin(u.id,u.enabled);R.showToast("Synced plugins",s.getAssetIDByName("Check"))});let l;const d=S.save.sync.themes.filter(function(u){return!Object.keys(C.themes).includes(u.id)});d.length>0&&await P(e,"Install Themes",`Would you like to install **${d.length}** new theme${d.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const u of d)u.enabled&&(l=u.id),await C.installTheme(u.id);R.showToast("Synced themes",s.getAssetIDByName("Check"))}),l&&await P(e,"Reload Required","A reload is required to apply the theme. Would you like to reload?","Reload","Skip",async function(){await C.fetchTheme(l,!0),Te.reload()}),n||R.showToast("Nothing to sync",s.getAssetIDByName("ic_sync_24px"))}const J=y.findByProps("isTablet"),{Text:Ie,View:Pe}=h.General,{FormRow:Ae}=h.Forms,{TextStyleSheet:W}=y.findByProps("TextStyleSheet"),q=t.stylesheet.createThemedStyleSheet({text:{...W["text-md/medium"],color:p.semanticColors.TEXT_NORMAL},button:{...W["text-md/medium"],color:p.semanticColors.TEXT_NORMAL,borderRadius:8}});function Ne(){const[e,n]=t.React.useState({});return r.authorization?t.React.createElement(Pe,{style:{flexDirection:J.isTablet?"row":"column",justifyContent:"flex-end"}},[{text:"Sync Data",onPress:async function(a){a(!0);try{S.save=await X(await K()),m(),R.showToast("Successfully synced data",s.getAssetIDByName("Check"))}catch(i){R.showToast(`Failed to sync data: ${i}`,s.getAssetIDByName("Small"))}a(!1)}},{text:"Load Data",onPress:async function(a){a(!0);try{await Ce(!0)}catch(i){console.log("ZOINKS",i)}a(!1)}}].map(function(a,i){const o=i!==0?8:0;return t.React.createElement(h.Button,{text:a.text,color:"green",size:"small",onPress:function(){return!e[i]&&a.onPress(function(c){n({...e,[i]:!!c})})},trailing:t.React.createElement(Ae.Icon,{source:s.getAssetIDByName("Check")}),loading:e[i],style:{...q.button,...J.isTablet?{marginLeft:o}:{marginTop:o}}})})):t.React.createElement(Ie,{style:{...q.text,textAlign:"center"}},"Authenticate first to manage your data")}const{FormSwitchRow:Z}=h.Forms;function De(){const[e,n]=t.React.useState(""),[,a]=t.React.useReducer(function(i){return~i},0);return t.React.useEffect(function(){n("")},[]),b.useProxy(r),t.NavigationNative.useNavigation().setOptions({title:"Plugin Settings",headerRight:function(){return t.React.createElement(V,{onPress:function(){return $.showConfirmationAlert({title:"Revert Settings",content:"Are you sure you want to revert all plugin settings?",confirmText:"Revert",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return r.pluginSettings={}}})},icon:s.getAssetIDByName("ic_message_delete"),style:"header"})}}),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(h.Search,{style:{marginBottom:10},onChangeText:function(i){return n(i.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.entries(T.plugins).filter(function(i){return i[1].manifest.name?.toLowerCase().includes(e)}),renderItem:function(i){let{item:[o,c]}=i;const l=r.pluginSettings[o]??{syncPlugin:!0,syncStorage:!0},d=function(){l.syncPlugin===!0&&l.syncStorage===!0?delete r.pluginSettings[o]:r.pluginSettings[o]=l,a()};return t.React.createElement(h.Summary,{label:c.manifest.name,icon:c.manifest.vendetta.icon??":3"},t.React.createElement(Z,{label:"Sync Plugin",onValueChange:function(){l.syncPlugin=!l.syncPlugin,d()},value:l.syncPlugin}),t.React.createElement(Z,{label:"Sync Plugin Storage",onValueChange:function(){l.syncStorage=!l.syncStorage,d()},value:l.syncStorage}))}})}var Q={github:{url:"https://github.com/Gabe616/VendettaPlugins/"}};const{showSimpleActionSheet:Be}=y.findByProps("showSimpleActionSheet"),$e=y.findByStoreName("UserStore");function _e(){const e=se.getDebugInfo(),n=t.ReactNative.NativeModules.InfoDictionaryManager??t.ReactNative.NativeModules.RTNClientInfoManager;return`Device: ${e.os.name==="iOS"?e.device.codename:`${e.device.brand} ${e.device.model}`}
Model: ${e.device.model}
Manufacturer: ${e.device.manufacturer}
Brand: ${e.device.brand}

OS: ${e.os.name}
Version: ${e.os.version}

Discord Branch: ${n.ReleaseChannel}
Discord Version: ${e.discord.version}
Discord Build: ${e.discord.build}
Vendetta Version: ${e.vendetta.version}

React Version: ${e.react.version}
Hermes Bytecode: ${e.hermes.bytecodeVersion}`}function ee(e){const n=$e.getCurrentUser(),a=new URLSearchParams;for(const[i,o]of Object.entries(e))a.set(i,o);return a.set("discord-username",`@${n.username}${n.discriminator!=="0"?`#${n.discriminator}`:""}`),console.log(`${Q.github.url}issues/new?${a.toString()}`),`${Q.github.url}issues/new?${a.toString()}`}const xe=function(e){return Be({key:"CardOverflow",header:{title:"GitHub Reports"},options:[{label:"Copy bug report link",icon:s.getAssetIDByName("copy"),onPress:function(){t.clipboard.setString(ee({title:`bug(${e}): `,template:"bug_report.yml",labels:"bug",sysinfo:_e()})),R.showToast("Copied",s.getAssetIDByName("toast_copy_link"))}},{label:"Copy feature suggestion link",icon:s.getAssetIDByName("copy"),onPress:function(){t.clipboard.setString(ee({title:`suggest(${e}): `,labels:"suggestion",template:"suggestion.yml"})),R.showToast("Copied",s.getAssetIDByName("toast_copy_link"))}}]})},{ScrollView:Me,View:Oe}=h.General,{FormRow:f,FormSwitchRow:te}=h.Forms;function ne(){const[,e]=t.React.useReducer(function(a){return~a},0);b.useProxy(r),g.cacheUpd.push(e),t.React.useEffect(function(){return function(){g.cacheUpd=g.cacheUpd.filter(function(a){return a!==e})}},[]);const n=t.NavigationNative.useNavigation();return n.setOptions({title:"CloudSync",headerRight:function(){return t.React.createElement(V,{icon:s.getAssetIDByName("ic_report_message"),style:"header",onPress:function(){return xe("cloud-sync")}})}}),t.React.createElement(Me,null,t.React.createElement(N,{title:"Current Data",icon:s.getAssetIDByName("ic_contact_sync"),padding:!0},t.React.createElement(Oe,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginVertical:8}},t.React.createElement(G,{count:S.save?.sync?.plugins?.length??"-",subtitle:"plugins",contents:2}),t.React.createElement(G,{count:S.save?.sync?.themes?.length??"-",subtitle:"themes",contents:2}))),t.React.createElement(N,{title:"Settings",icon:s.getAssetIDByName("ic_cog_24px")},t.React.createElement(te,{label:"Auto Sync",subLabel:"Automatically sync data to cloud",leading:t.React.createElement(f.Icon,{source:s.getAssetIDByName("ic_contact_sync")}),onValueChange:function(){return r.autoSync=!r.autoSync},value:r.autoSync}),t.React.createElement(te,{label:"Pin To Settings",subLabel:"Pin Cloud Sync to the settings page",leading:t.React.createElement(f.Icon,{source:s.getAssetIDByName("ic_message_pin")}),onValueChange:function(){return r.addToSettings=!r.addToSettings},value:r.addToSettings}),t.React.createElement(f,{label:"Plugin Settings",leading:t.React.createElement(f.Icon,{source:s.getAssetIDByName("debug")}),trailing:t.React.createElement(f.Arrow,null),onPress:function(){return n.push("VendettaCustomPage",{render:De})}})),t.React.createElement(N,{title:"Authentication",icon:s.getAssetIDByName("lock")},r.authorization?t.React.createElement(t.React.Fragment,null,t.React.createElement(f,{label:"Log out",subLabel:"Logs you out of CloudSync",leading:t.React.createElement(f.Icon,{source:s.getAssetIDByName("ic_logout_24px")}),onPress:function(){delete r.authorization,delete S.save,m(),R.showToast("Successfully logged out",s.getAssetIDByName("ic_logout_24px"))}}),t.React.createElement(f,{label:"Delete data",subLabel:"Deletes your data and logs you out of CloudSync",leading:t.React.createElement(f.Icon,{source:s.getAssetIDByName("trash")}),onPress:async function(){await we(),delete r.authorization,delete S.save,m(),R.showToast("Successfully deleted data",s.getAssetIDByName("trash"))}})):t.React.createElement(f,{label:"Authenticate",leading:t.React.createElement(f.Icon,{source:s.getAssetIDByName("copy")}),trailing:f.Arrow,onPress:be})),t.React.createElement(N,{title:"Data Management",icon:s.getAssetIDByName("ic_message_edit"),padding:!0},t.React.createElement(Ne,null),r.authorization&&t.React.createElement(t.React.Fragment,null,t.React.createElement(he,null),t.React.createElement(f,{label:"Copy Data as JSON",leading:t.React.createElement(f.Icon,{source:s.getAssetIDByName("copy")}),onPress:function(){t.clipboard.setString(JSON.stringify(S.save??{},void 0,3)),R.showToast("Copied",s.getAssetIDByName("Check"))}}))))}let ae=0;function ke(e){clearTimeout(ae),ae=setTimeout(e,1500)}const{FormRow:x}=h.Forms;function Le(){const e=t.NavigationNative.useNavigation();return React.createElement(h.ErrorBoundary,null,React.createElement(x,{label:"Cloud Sync",leading:React.createElement(x.Icon,{source:s.getAssetIDByName("ic_contact_sync")}),trailing:x.Arrow,onPress:function(){return e.push("VendettaCustomPage",{render:ne})}}))}const{FormSection:Ue}=h.Forms,ze=y.findByName("UserSettingsOverviewWrapper",!1);function Ve(){let e=[],n=v.after("default",ze,function(a,i){n();const o=U.findInReactTree(i.props.children,function(c){return c.type&&c.type.name==="UserSettingsOverview"});e.push(v.after("render",o.type.prototype,function(c,l){let{props:{children:d}}=l;if(!r.addToSettings)return;const u=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];d=U.findInReactTree(d,function(B){return B.children[1].type===Ue}).children;const D=d.findIndex(function(B){return u.includes(B?.props.label)});d.splice(D===-1?4:D,0,React.createElement(Le,null))}))},!0);return function(){return e.forEach(function(a){return a()})}}const r=oe.storage,S={};g.cacheUpd=[];function m(){g.cacheUpd.forEach(function(e){return e()})}async function M(){try{S.save=await Re()}catch{}m()}async function P(e,n,a,i,o,c,l){return e?new Promise(function(d){$.showConfirmationAlert({title:n,content:a,confirmText:i,cancelText:o,confirmColor:"green",isDismissable:!1,onConfirm:function(){return c?c().then(d):d()},onCancel:function(){return l?l().then(d):d()}})}):await c?.()}function O(e){return e.startsWith(ce.PROXY_PREFIX)}const k=async function(){if(!r.autoSync)return;const e=await K();JSON.stringify(S.save)!==JSON.stringify(e)&&ke(async function(){S.save=await X(e),m()})};let E=[],ie=!1,L=!1;const re=function(){E.push(v.after("createMMKVBackend",b,function(e,n){E.push(v.after("set",n,function(){return k()}))}))},A=1;r.autoSync??=!1,r.addToSettings??=!0,r.pluginSettings??={},t.FluxDispatcher.subscribe("I18N_LOAD_SUCCESS",function(){ie=!0,L&&re()});var Fe={onLoad:function(){L=!0,r.authorization&&M(),["installPlugin","startPlugin","stopPlugin","removePlugin"].forEach(function(n){return E.push(v.after(n,T,function(){return k()}))}),["installTheme","selectTheme","removeTheme"].forEach(function(n){return E.push(v.after(n,C,function(){return k()}))}),ie&&re(),E.push(Ve());const e=function(n,a){return $.showConfirmationAlert({title:n,content:a,onConfirm:function(){},confirmText:"Dismiss",confirmColor:"brand",secondaryConfirmText:"Don't show again",onConfirmSecondary:function(){return r.databaseMigrate=A}})};(window.CSmigrationStage===void 0||r.databaseMigrate!==A&&window.CSmigrationStage!==A)&&(window.CSmigrationStage=A,e("Cloud Sync \u2014 DB Migration Stage 1",`Hey, I'd like to quickly announce that CloudSync will be switching databases soon and your data may get ***deleted***. Make sure to keep an eye on your data for the upcoming weeks!

- nexx`))},onUnload:function(){L=!1,E.forEach(function(e){return e()})},settings:ne};return g.cache=S,g.cacheUpdated=m,g.currentMigrationStage=A,g.default=Fe,g.fillCache=M,g.isPluginProxied=O,g.promptOrRun=P,g.vstorage=r,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.plugin,vendetta.storage,vendetta.patcher,vendetta.plugins,vendetta.themes,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.alerts,vendetta.metro.common,vendetta.metro,vendetta.utils,vendetta.ui.components,vendetta.constants,vendetta.ui,vendetta.debug);
